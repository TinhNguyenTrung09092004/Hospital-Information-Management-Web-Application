@model X.PagedList.IPagedList<QLBenhVien.Entities.ViewTaiVu>
<p>Mã nhân viên: @User.FindFirst("MaNhanVien")?.Value</p>

<div class="container mt-1">
    <h4>Danh sách bệnh nhân chưa thanh toán</h4>

    <table class="table table-bordered table-striped" id="table-taivu">
        <thead>
            <tr>
                <th style="width: 10%; text-align:center;">STT</th>
                <th style="width: 25%;">Mã Bệnh Nhân</th>
                <th style="width: 25%;">Tên Bệnh Nhân</th>
                <th style="width: 25%;">Dịch Vụ</th>
                <th style="width: 15%;">Thao tác</th>
            </tr>
        </thead>
        @{
            var grouped = Model.GroupBy(x => x.MaKhamBenh);
            int stt = 1;
        }
        <tbody>
            @foreach (var group in grouped)
            {
                var first = group.First();
                <tr>
                    <td style="text-align:center;">@stt</td>
                    <td>@first.MaBenhNhan</td>
                    <td>@first.HoTenBenhNhan</td>
                    <td>
                        <ul class="mb-0 ps-3">
                            @foreach (var dv in group)
                            {
                                <li>@dv.TenDichVu</li>
                            }
                        </ul>
                    </td>
                    <td>
                        <form method="post" asp-controller="TaiVu" asp-action="ThanhToan">
                            <input type="hidden" name="maKhamBenh" value="@first.MaKhamBenh" />
                            <button type="submit" class="btn btn-success btn-sm">Thanh toán</button>
                        </form>
                    </td>
                </tr>
                stt++;
            }
        </tbody>

    </table>
</div>

<div class="container mt-4">
    <div class="row">
        <div class="col-4"></div>
        <div class="col-4"></div>
        <div class="col-4">
            <div class="d-flex justify-content-end">
                @Html.PagedListPager(Model, page => Url.Action("Index", new { page }),
                         new PagedListRenderOptions
                {
                    DisplayLinkToFirstPage = PagedListDisplayMode.Always,
                    DisplayLinkToLastPage = PagedListDisplayMode.Always,
                    DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                    DisplayLinkToNextPage = PagedListDisplayMode.Always,
                    MaximumPageNumbersToDisplay = 5,
                    UlElementClasses = new[] { "pagination" },
                    LiElementClasses = new[] { "page-item" },
                    PageClasses = new[] { "page-link" }
                })
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const forms = document.querySelectorAll('#table-taivu form');

            forms.forEach(form => {
                form.addEventListener('submit', function (e) {
                    const maKhamBenh = form.querySelector('input[name="maKhamBenh"]')?.value;

                    const confirmResult = confirm(`Xác nhận thanh toán cho mã khám bệnh ${maKhamBenh}?`);
                    if (!confirmResult) {
                        e.preventDefault();
                    }
                });
            });
        });
    </script>
}
